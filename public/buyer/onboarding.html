<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Proofwork • Platform Onboarding</title>
    <link rel="stylesheet" href="/ui/ui.css" />
  </head>
  <body class="theme-buyer" data-portal="buyer">
    <header class="pw-topbar">
      <div class="pw-topbar-inner">
        <a class="pw-brand" href="/apps/" aria-label="Proofwork home">
          <span class="pw-brand-badge pw-mono">PW</span>
          Proofwork
        </a>
        <nav class="pw-topnav" aria-label="Primary">
          <a class="pw-navlink" href="/apps/">Catalog</a>
          <a class="pw-navlink" href="/buyer/" aria-current="page">Platforms</a>
          <a class="pw-navlink" href="/worker/">Workers</a>
          <a class="pw-navlink" href="/admin/">Admin</a>
          <a class="pw-navlink" href="/docs/" target="_blank" rel="noreferrer">Docs</a>
        </nav>
      </div>
    </header>

    <main class="pw-container">
      <section class="pw-hero" id="home">
        <h1>Platform onboarding</h1>
        <p>Attach your platform, publish an app, and create your first bounty without reading docs.</p>
        <div class="pw-hero-actions">
          <div class="pw-badge" id="wizTopStatus">Checking status…</div>
          <div class="pw-actions">
            <a class="pw-btn" href="/buyer/">Open full console</a>
            <a class="pw-btn primary" href="/apps/">Browse apps</a>
          </div>
        </div>
      </section>

      <div class="pw-console pw-wizard">
        <section class="pw-stack" aria-label="Onboarding content">
          <section class="pw-card soft" aria-label="Guided checklist">
            <div class="pw-card-title">
              <h2>Guided checklist</h2>
              <span class="pw-kicker">5 to 10 minutes</span>
            </div>
            <div class="pw-stepper">
              <a class="pw-step pw-step-link" href="#connect" id="navConnect" aria-current="page">
                <div class="pw-step-dot">1</div>
                <div>
                  <div class="pw-step-title">Create org and connect</div>
                  <div class="pw-step-desc">Register your platform (recommended) or sign in. Cookie session, CSRF-safe.</div>
                </div>
                <span class="pw-pill warn" id="badgeConnect">1</span>
              </a>
              <a class="pw-step pw-step-link" href="#origin" id="navOrigin">
                <div class="pw-step-dot">2</div>
                <div>
                  <div class="pw-step-title">Verify your origin</div>
                  <div class="pw-step-desc">Required for publishing from your own domains. Copy buttons included.</div>
                </div>
                <span class="pw-pill faint" id="badgeOrigin">-</span>
              </a>
              <a class="pw-step pw-step-link" href="#fees" id="navFees">
                <div class="pw-step-dot">3</div>
                <div>
                  <div class="pw-step-title">Set your platform cut</div>
                  <div class="pw-step-desc">Your platform chooses its percentage. Proofwork always takes 1% from the worker portion.</div>
                </div>
                <span class="pw-pill faint" id="badgeFees">-</span>
              </a>
              <a class="pw-step pw-step-link" href="#cors" id="navCors">
                <div class="pw-step-dot">4</div>
                <div>
                  <div class="pw-step-title">Allow your web UI (optional)</div>
                  <div class="pw-step-desc">If your platform calls Proofwork from the browser, add a per-org CORS allowlist.</div>
                </div>
                <span class="pw-pill faint" id="badgeCors">Optional</span>
              </a>
              <a class="pw-step pw-step-link" href="#app" id="navApp">
                <div class="pw-step-dot">5</div>
                <div>
                  <div class="pw-step-title">Register your first app</div>
                  <div class="pw-step-desc">Apps publish instantly. Each app defines the friendly form for job creation.</div>
                </div>
                <span class="pw-pill faint" id="badgeApp">-</span>
              </a>
              <a class="pw-step pw-step-link" href="#publish" id="navPublish">
                <div class="pw-step-dot">6</div>
                <div>
                  <div class="pw-step-title">Publish work and get paid</div>
                  <div class="pw-step-desc">Pick an app, fill the form, publish. Default dispute posture: 1-day hold.</div>
                </div>
                <span class="pw-pill faint" id="badgePublish">-</span>
              </a>
            </div>
            <div class="pw-help">Only do the required steps. Everything else is automated.</div>
          </section>

          <section class="pw-card pw-wizard-step" id="stepConnect" data-step="connect">
            <div class="pw-card-title">
              <h2>Connect</h2>
              <span class="pw-kicker">Required</span>
            </div>
            <p class="pw-muted">Sign in (recommended) or create a new platform org. We use a cookie session for safety and CSRF protection.</p>

            <div class="pw-row" id="connectConnectedRow" hidden>
              <div class="pw-field">
                <div class="pw-badge">
                  Connected as <span class="pw-mono" id="connectEmail">buyer</span>
                  <span class="pw-muted">• session active</span>
                </div>
              </div>
              <div class="pw-field">
                <label>&nbsp;</label>
                <div class="pw-actions">
                  <button class="pw-btn danger" id="btnLogout" type="button">Disconnect</button>
                </div>
              </div>
            </div>

            <div class="pw-tabs" role="tablist" aria-label="Connect options" id="connectTabs">
              <button class="pw-tab active" id="tabSignIn" type="button" role="tab" aria-selected="true" aria-controls="panelSignIn">Sign in</button>
              <button class="pw-tab" id="tabRegister" type="button" role="tab" aria-selected="false" aria-controls="panelRegister">Create org</button>
            </div>

            <div class="pw-tabpanels">
              <div class="pw-tabpanel" id="panelSignIn" role="tabpanel" aria-labelledby="tabSignIn">
                <div class="pw-row">
                  <div class="pw-field">
                    <label for="loginEmail">Email</label>
                    <input class="pw-input" id="loginEmail" autocomplete="email" placeholder="buyer@company.com" />
                  </div>
                  <div class="pw-field">
                    <label for="loginPassword">Password</label>
                    <input class="pw-input" id="loginPassword" type="password" autocomplete="current-password" placeholder="password" />
                  </div>
                </div>
                <div class="pw-actions">
                  <button class="pw-btn primary" id="btnLogin" type="button">Sign in</button>
                </div>
                <div id="loginStatus" class="pw-status" role="status"></div>
              </div>

              <div class="pw-tabpanel" id="panelRegister" role="tabpanel" aria-labelledby="tabRegister" hidden>
                <div class="pw-row">
                  <div class="pw-field">
                    <label for="regOrgName">Org name</label>
                    <input class="pw-input" id="regOrgName" placeholder="My Platform" />
                  </div>
                  <div class="pw-field">
                    <label for="regApiKeyName">API key name</label>
                    <input class="pw-input" id="regApiKeyName" value="default" />
                  </div>
                </div>
                <div class="pw-row">
                  <div class="pw-field">
                    <label for="regEmail">Email</label>
                    <input class="pw-input" id="regEmail" autocomplete="email" placeholder="you@company.com" />
                  </div>
                  <div class="pw-field">
                    <label for="regPassword">Password</label>
                    <input class="pw-input" id="regPassword" type="password" autocomplete="new-password" placeholder="min 8 chars" />
                  </div>
                </div>
                <div class="pw-actions">
                  <button class="pw-btn primary" id="btnRegister" type="button">Create org</button>
                </div>
                <div id="regStatus" class="pw-status" role="status"></div>

                <details class="pw-details pw-dev">
                  <summary>Developer response</summary>
                  <div class="pw-details-body">
                    <pre class="pw-codeblock" id="regOut">{}</pre>
                  </div>
                </details>
              </div>
            </div>

            <details class="pw-details" id="tokenTools" hidden>
              <summary>Advanced: API token (for server-to-server integrations)</summary>
              <div class="pw-details-body">
                <div class="pw-row">
                  <div class="pw-field">
                    <label for="keyName">API key name</label>
                    <input class="pw-input" id="keyName" value="portal" />
                  </div>
                  <div class="pw-field">
                    <label>&nbsp;</label>
                    <button class="pw-btn primary" id="btnCreateKey" type="button">Create API token</button>
                  </div>
                </div>
                <div class="pw-field">
                  <label for="buyerToken">Buyer token</label>
                  <input class="pw-input" id="buyerToken" placeholder="pw_bu_…" />
                </div>
                <div class="pw-actions">
                  <button class="pw-btn" id="btnCopyBuyerToken" type="button">Copy token</button>
                </div>
                <div id="keyStatus" class="pw-status" role="status"></div>
              </div>
            </details>
          </section>

          <section class="pw-card pw-wizard-step" id="stepOrigin" data-step="origin" hidden>
            <div class="pw-card-title">
              <h2>Verify your origin</h2>
              <span class="pw-kicker">Required for your domains</span>
            </div>
            <p class="pw-muted">
              Publishing from your own domains requires a verified origin. Built-in apps may include supported public origins, which can be published without verification.
            </p>

            <div class="pw-row">
              <div class="pw-field">
                <label for="originUrl">Origin URL</label>
                <input class="pw-input" id="originUrl" placeholder="https://app.yourdomain.com" />
              </div>
              <div class="pw-field">
                <label for="originMethod">Method</label>
                <select class="pw-select" id="originMethod">
                  <option value="dns_txt" selected>DNS TXT</option>
                  <option value="http_file">HTTP file</option>
                  <option value="header">Header</option>
                </select>
              </div>
            </div>

            <div class="pw-actions">
              <button class="pw-btn primary" id="btnAddOrigin" type="button">Add origin</button>
              <button class="pw-btn" id="btnListOrigins" type="button">Refresh list</button>
            </div>
            <div id="originStatus" class="pw-status" role="status"></div>

            <div class="pw-card soft" id="originGuide">
              <div class="pw-card-title">
                <h3>Verification instructions</h3>
                <span class="pw-kicker" id="originGuideKicker">Add an origin to see exact steps</span>
              </div>
              <div id="originGuideBody" class="pw-stack"></div>
            </div>

            <div class="pw-scroll">
              <table class="pw-table" aria-label="Origins list">
                <thead>
                  <tr>
                    <th>Status</th>
                    <th>Origin</th>
                    <th>Method</th>
                    <th>Verified</th>
                    <th>Failure</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="originsTbody"></tbody>
              </table>
            </div>
          </section>

          <section class="pw-card pw-wizard-step" id="stepCors" data-step="cors" hidden>
            <div class="pw-card-title">
              <h2>Browser CORS allowlist</h2>
              <span class="pw-kicker">Optional</span>
            </div>
            <p class="pw-muted">Only needed if your own platform web UI calls Proofwork APIs directly from the browser. One origin per line.</p>

            <div class="pw-field">
              <label for="corsOrigins">Allowed origins</label>
              <textarea class="pw-textarea" id="corsOrigins" placeholder="https://app.yourdomain.com"></textarea>
            </div>
            <div class="pw-actions">
              <button class="pw-btn" id="btnGetCors" type="button">Load</button>
              <button class="pw-btn primary" id="btnSetCors" type="button">Save</button>
            </div>
            <div id="corsStatus" class="pw-status" role="status"></div>
          </section>

          <section class="pw-card pw-wizard-step" id="stepFees" data-step="fees" hidden>
            <div class="pw-card-title">
              <h2>Fees</h2>
              <span class="pw-kicker">Required</span>
            </div>
            <p class="pw-muted">Your platform can take a cut from each successful job. Proofwork always takes a fixed 1% from the worker portion.</p>

            <div class="pw-row">
              <div class="pw-field">
                <label for="pfPct">Platform cut</label>
                <input class="pw-input" id="pfPct" type="range" min="0" max="20" value="5" />
                <div class="pw-help">
                  Current: <span class="pw-mono" id="pfPctLabel">5%</span>
                  <span class="pw-dev">(<span class="pw-mono" id="pfBpsLabel">500 bps</span>)</span>
                </div>
              </div>
              <div class="pw-field">
                <label for="pfWallet">Platform wallet (Base)</label>
                <input class="pw-input" id="pfWallet" placeholder="0x…" />
                <div class="pw-help">Required when cut is non-zero.</div>
              </div>
            </div>
            <div class="pw-actions">
              <button class="pw-btn primary" id="btnSetPlatformFee" type="button">Save fee</button>
            </div>
            <div id="pfStatus" class="pw-status" role="status"></div>
          </section>

          <section class="pw-card pw-wizard-step" id="stepApp" data-step="app" hidden>
            <div class="pw-card-title">
              <h2>Create your first app</h2>
              <span class="pw-kicker">Required</span>
            </div>
            <p class="pw-muted">Apps define the friendly form that job publishers use. Apps show up instantly. No admin approval.</p>

            <div class="pw-row">
              <div class="pw-field">
                <label for="appName">App name</label>
                <input class="pw-input" id="appName" placeholder="e.g. Flight deals monitor" />
              </div>
              <div class="pw-field">
                <label>Template</label>
                <div class="pw-template-grid" id="appTemplateGrid" role="list" aria-label="App templates"></div>
                <div class="pw-help">Pick a starting point. You can edit fields later.</div>

                <div class="pw-dev pw-mt-10">
                  <label for="appTemplate">Developer: template id</label>
                  <select class="pw-select" id="appTemplate">
                    <option value="generic_http" selected>generic_http</option>
                    <option value="github_scan">github_scan</option>
                    <option value="research_arxiv">research_arxiv</option>
                    <option value="marketplace_watch">marketplace_watch</option>
                  </select>
                </div>
              </div>
            </div>

            <details class="pw-details" id="appAdvancedIds">
              <summary>Advanced identifiers</summary>
              <div class="pw-details-body">
                <div class="pw-row">
                  <div class="pw-field">
                    <label for="appSlug">Slug</label>
                    <input class="pw-input" id="appSlug" placeholder="my-app" />
                    <div class="pw-help">Auto-generated from name.</div>
                  </div>
                  <div class="pw-field">
                    <label for="appTaskType">Task type</label>
                    <input class="pw-input" id="appTaskType" placeholder="my_task_type" />
                    <div class="pw-help">Routes work to this app<span class="pw-dev"> (Dev: <span class="pw-mono">task_descriptor.type</span>)</span>.</div>
                  </div>
                </div>
              </div>
            </details>

            <div class="pw-actions">
              <button class="pw-btn primary" id="btnCreateOrgApp" type="button">Create app</button>
              <button class="pw-btn" id="btnListOrgApps" type="button">Refresh</button>
            </div>
            <div id="appsStatus" class="pw-status" role="status"></div>

            <div class="pw-scroll">
              <table class="pw-table" aria-label="Apps list">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Slug</th>
                    <th>Task type</th>
                    <th>Public</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="appsTbody"></tbody>
              </table>
            </div>
          </section>

          <section class="pw-card pw-wizard-step" id="stepPublish" data-step="publish" hidden>
            <div class="pw-card-title">
              <h2>Publish work</h2>
              <span class="pw-kicker">Required</span>
            </div>
            <p class="pw-muted">
              Pick an app, fill the friendly form, and publish. We auto-fill payout, proofs, and origin when possible. Dev mode reveals the raw descriptor preview.
            </p>

            <div class="pw-card soft" id="nextAppCard" hidden>
              <div class="pw-card-title">
                <h3>Continue where you left off</h3>
                <span class="pw-kicker">From catalog</span>
              </div>
              <p class="pw-muted" id="nextAppText">Open the app page to publish work.</p>
              <div class="pw-actions">
                <a class="pw-btn primary" id="nextAppLink" href="/apps/" rel="noreferrer">Open app page</a>
                <button class="pw-btn" id="btnDismissNextApp" type="button">Dismiss</button>
              </div>
            </div>

            <div class="pw-row">
              <div class="pw-field">
                <label for="publishApp">App</label>
                <select class="pw-select" id="publishApp"></select>
                <div class="pw-help" id="publishAppHelp">Your apps appear first. Built-in apps are also available for quick tests.</div>
              </div>
              <div class="pw-field">
                <label>&nbsp;</label>
                <div class="pw-actions">
                  <button class="pw-btn primary" id="btnPublishNow" type="button">Create + publish</button>
                  <a class="pw-btn" id="btnOpenAppPage" href="/apps/" rel="noreferrer">Open app page</a>
                  <button class="pw-btn" id="btnCheckPublish" type="button">Check status</button>
                </div>
              </div>
            </div>

            <div id="publishPreflight" class="pw-status" role="status"></div>
            <div class="pw-badge" id="publishStatus">Checking publish status…</div>

            <div class="pw-grid">
              <div class="pw-stack">
                <div id="publishForm"></div>

                <details class="pw-details pw-dev">
                  <summary>Developer: descriptor preview</summary>
                  <div class="pw-details-body">
                    <pre class="pw-codeblock" id="publishDescriptorOut">{}</pre>
                  </div>
                </details>
              </div>

              <div class="pw-stack">
                <details class="pw-fold" id="publishSettingsFold">
                  <summary>
                    <div>
                      <div class="pw-fold-title">Adjust settings</div>
                      <div class="pw-fold-sub">Optional: origin, payout, proofs, title</div>
                    </div>
                    <span class="pw-pill faint" id="publishPayoutPill">Defaults</span>
                  </summary>
                  <div class="pw-fold-body">
                    <div class="pw-card soft">
                      <div class="pw-kicker">Allowed origin</div>
                      <div class="pw-muted">Verified origins are required for your own domains. System apps may also provide supported origins.</div>
                      <div class="pw-field" id="publishOriginSelectWrap">
                        <label class="pw-offscreen" for="publishOriginSelect">Origin</label>
                        <select class="pw-select" id="publishOriginSelect"></select>
                      </div>
                      <div class="pw-field" id="publishOriginSingle" hidden>
                        <div class="pw-badge">
                          Origin: <span class="pw-mono" id="publishOriginSingleText">—</span>
                        </div>
                      </div>
                      <div class="pw-actions">
                        <button class="pw-btn" id="btnRefreshPublishOrigins" type="button">Refresh</button>
                        <button class="pw-btn" id="btnJumpToOrigin" type="button">Verify origin</button>
                      </div>
                    </div>

                    <div class="pw-presets" id="publishPayoutPresets" aria-label="Payout presets"></div>
                    <div class="pw-row">
                      <div class="pw-field">
                        <label for="publishPayoutCents">Payout (cents)</label>
                        <input class="pw-input" id="publishPayoutCents" type="number" value="1000" />
                      </div>
                      <div class="pw-field">
                        <label for="publishRequiredProofs">Proofs</label>
                        <input class="pw-input" id="publishRequiredProofs" type="number" value="2" />
                      </div>
                    </div>
                    <div class="pw-help" id="publishPayoutBreakdown"></div>

                    <div class="pw-row">
                      <div class="pw-field">
                        <label for="publishTitle">Title (optional)</label>
                        <input class="pw-input" id="publishTitle" placeholder="Auto-filled" />
                        <div class="pw-help">Titles help you find bounties later. Everything else is generated from the form.</div>
                      </div>
                    </div>
                  </div>
                </details>

                <div class="pw-card soft" id="publishDeliverablesCard">
                  <div class="pw-kicker">Deliverables</div>
                  <div class="pw-muted" id="publishDeliverablesSub">What workers must submit for this app.</div>
                  <div class="pw-chips" id="publishDeliverablesList"></div>
                  <div class="pw-help" id="publishDeliverablesHelp"></div>
                </div>

                <div class="pw-card soft" id="publishResultCard" hidden>
                  <div class="pw-card-title">
                    <h3>Published</h3>
                    <span class="pw-kicker">Next</span>
                  </div>
                  <div class="pw-muted" id="publishResultText">Your bounty is live.</div>
                  <div class="pw-actions">
                    <a class="pw-btn primary" id="publishResultMonitorLink" href="/apps/" rel="noreferrer">Open monitor</a>
                    <a class="pw-btn" href="/buyer/#money">View money</a>
                  </div>
                </div>
              </div>
            </div>

            <div class="pw-actions">
              <a class="pw-btn" href="/worker/">Worker portal</a>
              <a class="pw-btn" href="/admin/">Admin console</a>
              <a class="pw-btn" href="/docs/view.html?path=runbooks/ThirdPartyOnboarding.md" target="_blank" rel="noreferrer">Read runbook</a>
            </div>
          </section>
        </section>
      </div>
    </main>

    <script type="module" src="/buyer/onboarding.js"></script>
    <script type="module" src="/ui/shell.js"></script>
  </body>
</html>
