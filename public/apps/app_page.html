<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title></title>
    <link rel="stylesheet" href="/ui/ui.css" />
  </head>
  <body class="theme-apps pw-has-actionbar" data-portal="apps">
    <header class="pw-topbar">
      <div class="pw-topbar-inner">
        <a class="pw-brand" href="/apps/" aria-label="Proofwork home">
          <span class="pw-brand-badge pw-mono">PW</span>
          Proofwork
        </a>
        <nav class="pw-topnav" aria-label="Primary">
          <a class="pw-navlink" href="/apps/" aria-current="page">Catalog</a>
          <a class="pw-navlink" href="/buyer/">Platforms</a>
          <a class="pw-navlink" href="/worker/">Workers</a>
          <a class="pw-navlink" href="/admin/">Admin</a>
          <a class="pw-navlink" href="/docs/" target="_blank" rel="noreferrer">Docs</a>
        </nav>
      </div>
    </header>

    <main class="pw-container">
      <section class="pw-hero">
        <h1 id="hdrTitle"></h1>
        <p id="hdrDesc"></p>
        <div class="pw-hero-actions">
          <div class="pw-badge">
            New platform? Follow <a href="/buyer/onboarding.html">onboarding</a>. Already onboarded? Sign in and publish.
            <span class="pw-dev">Need an API token? Use Dev mode.</span>
          </div>
          <div class="pw-actions">
            <a class="pw-btn" href="/apps/">All apps</a>
            <a class="pw-btn primary" href="/buyer/">Platform console</a>
          </div>
        </div>
      </section>

      <div class="pw-console">
        <aside class="pw-sidebar pw-sidebar-collapsible" aria-label="App navigation">
          <nav class="pw-sidenav">
            <a href="#create" aria-current="page">Create work</a>
            <a href="#monitor">Monitor</a>
            <div class="pw-sidenav-group">
              <div class="pw-sidenav-title">Advanced</div>
              <a href="#advanced" class="pw-dev">Descriptor JSON</a>
            </div>
          </nav>
        </aside>

        <section class="pw-stack" aria-label="App content">
          <section class="pw-card pw-view" id="create" data-view>
            <div class="pw-card-title">
              <h2>Create work</h2>
              <span class="pw-kicker" id="appBadges"></span>
            </div>

            <div class="pw-stepper">
              <div class="pw-step" id="stepConnect">
                <div class="pw-step-dot">1</div>
                <div>
                  <div class="pw-step-title">Connect</div>
                  <div class="pw-step-desc">Sign in. Passwords are never stored; interactive sessions use cookies + CSRF.</div>
                </div>
              </div>
              <div class="pw-step" id="stepDescribe">
                <div class="pw-step-dot">2</div>
                <div>
                  <div class="pw-step-title">Describe</div>
                  <div class="pw-step-desc">Fill a simple form; we generate the descriptor automatically.</div>
                </div>
              </div>
              <div class="pw-step" id="stepPublish">
                <div class="pw-step-dot">3</div>
                <div>
                  <div class="pw-step-title">Publish</div>
                  <div class="pw-step-desc">Review settings (optional), then publish work.</div>
                </div>
              </div>
            </div>

            <div class="pw-row" id="connectedRow" hidden>
              <div class="pw-field">
                <div class="pw-badge">
                  Connected: <span class="pw-mono" id="connectedTokenPrefix">session</span>
                  <span class="pw-muted">• session or token</span>
                </div>
              </div>
              <div class="pw-field">
                <label>&nbsp;</label>
                <div class="pw-actions">
                  <button class="pw-btn" id="btnChangeToken" type="button">Change</button>
                  <button class="pw-btn danger" id="btnDisconnect" type="button">Disconnect</button>
                </div>
              </div>
            </div>

            <details class="pw-fold" id="foldConnect" open>
              <summary>
                <div>
                  <div class="pw-fold-title">Connect</div>
                  <div class="pw-fold-sub">Sign in to publish work</div>
                </div>
                <span class="pw-pill warn" id="pillConnect">Required</span>
              </summary>
              <div class="pw-fold-body">
                  <div class="pw-card soft" id="connectRow">
                    <div class="pw-card-title">
                      <h3>Connect</h3>
                      <span class="pw-kicker">Required</span>
                    </div>
                  <p class="pw-muted">
                    Sign in to publish work. Passwords are never stored; interactive sessions use cookies + CSRF.
                    <span class="pw-dev">API tokens are available in Dev mode for server-to-server integrations.</span>
                  </p>

                  <div class="pw-tabs" role="tablist" aria-label="Connect options">
                    <button class="pw-tab" id="tabSignIn" type="button" role="tab" aria-selected="true" aria-controls="panelSignIn">Sign in</button>
                    <!-- Token mode is developer-oriented; keep it out of the happy-path UX. -->
                    <button class="pw-tab pw-dev" id="tabToken" type="button" role="tab" aria-selected="false" aria-controls="panelToken">API token</button>
                  </div>

                  <div class="pw-tabpanels">
                    <div class="pw-tabpanel" id="panelSignIn" role="tabpanel" aria-labelledby="tabSignIn">
                      <div class="pw-row">
                        <div class="pw-field">
                          <label for="loginEmail">Email</label>
                          <input class="pw-input" id="loginEmail" autocomplete="email" placeholder="buyer@company.com" />
                        </div>
                        <div class="pw-field">
                          <label for="loginPassword">Password</label>
                          <input class="pw-input" id="loginPassword" type="password" autocomplete="current-password" placeholder="password" />
                        </div>
                      </div>
                      <div class="pw-actions">
                        <button class="pw-btn primary" id="btnLogin" type="button">Sign in</button>
                        <a class="pw-btn" href="/buyer/" rel="noreferrer">Platform console</a>
                      </div>
                      <div id="loginStatus" class="pw-status" role="status"></div>

                      <details class="pw-details" id="registerFold">
                        <summary>New platform? Create an org</summary>
                        <div class="pw-details-body">
                          <p class="pw-muted">
                            Creates your org and an initial API key, then signs you in. Uses the Email and Password fields above.
                          </p>
                          <div class="pw-row">
                            <div class="pw-field">
                              <label for="regOrgName">Org name</label>
                              <input class="pw-input" id="regOrgName" placeholder="My Platform" />
                            </div>
                            <div class="pw-field">
                              <label for="regApiKeyName">API key name</label>
                              <input class="pw-input" id="regApiKeyName" value="default" />
                            </div>
                          </div>
                          <div class="pw-actions">
                            <button class="pw-btn primary" id="btnRegisterOrg" type="button">Create org + sign in</button>
                          </div>
                          <div id="regStatus" class="pw-status" role="status"></div>
                          <details class="pw-details pw-dev">
                            <summary>Developer response</summary>
                            <div class="pw-details-body">
                              <pre class="pw-codeblock" id="regOut">{}</pre>
                            </div>
                          </details>
                        </div>
                      </details>
                    </div>

                    <div class="pw-tabpanel pw-dev" id="panelToken" role="tabpanel" aria-labelledby="tabToken" hidden>
                      <div class="pw-row">
                        <div class="pw-field">
                          <label for="buyerToken">Buyer token</label>
                          <input class="pw-input" id="buyerToken" placeholder="pw_bu_…" />
                        </div>
                        <div class="pw-field">
                          <label>&nbsp;</label>
                          <button class="pw-btn primary" id="btnSaveToken" type="button">Connect</button>
                        </div>
                      </div>
                      <div class="pw-help">Tip: tokens are best for programmatic platform integrations. For interactive use, sign in.</div>
                    </div>
                  </div>
                </div>
              </div>
            </details>

            <div id="createAfterConnect" hidden>
              <details class="pw-fold" id="foldDescribe" open>
                <summary>
                  <div>
                    <div class="pw-fold-title">Describe</div>
                    <div class="pw-fold-sub">Fill the required fields. Optional inputs stay out of your way.</div>
                  </div>
                  <span class="pw-pill faint" id="pillDescribe">Next</span>
                </summary>
                <div class="pw-fold-body">
                  <div class="pw-card soft" id="templateCard" hidden>
                    <div class="pw-card-title">
                      <h3>Starting point</h3>
                      <span class="pw-kicker">Optional</span>
                    </div>
                    <div class="pw-muted">Pick a template to prefill the form. Switching templates will not overwrite fields you have edited.</div>
                    <div class="pw-template-grid" id="templateGrid" role="list" aria-label="Templates"></div>
                  </div>

                  <div class="pw-row pw-dev" id="templateRow">
                    <div class="pw-field">
                      <label for="template">Developer: template</label>
                      <select class="pw-select" id="template"></select>
                    </div>
                    <div class="pw-field">
                      <label>&nbsp;</label>
                      <button class="pw-btn" id="btnApplyTemplate" type="button">Apply (overwrite)</button>
                    </div>
                  </div>

                  <div id="form"></div>
                </div>
              </details>

              <details class="pw-fold" id="foldPublish" open>
                <summary>
                  <div>
                    <div class="pw-fold-title">Publish</div>
                    <div class="pw-fold-sub">Review settings (optional), then publish</div>
                  </div>
                  <span class="pw-pill faint" id="pillPublish">Waiting</span>
                </summary>
                <div class="pw-fold-body">
                  <div class="pw-grid">
                    <details class="pw-fold" id="settingsFold">
                      <summary>
                        <div>
                          <div class="pw-fold-title">Adjust settings</div>
                          <div class="pw-fold-sub">Optional: origin, payout, proofs, title</div>
                        </div>
                        <span class="pw-pill faint" id="payoutPill">Defaults</span>
                      </summary>
                      <div class="pw-fold-body">
                        <div class="pw-card soft">
                          <div class="pw-kicker">Allowed origin</div>
                          <div class="pw-muted">Verified origins are required for your own domains. System apps may also provide supported origins.</div>
                          <div class="pw-field" id="originSelectWrap">
                            <label class="pw-offscreen" for="originSelect">Origin</label>
                            <select class="pw-select" id="originSelect"></select>
                          </div>
                          <div class="pw-field" id="originSingle" hidden>
                            <div class="pw-badge">
                              Origin: <span class="pw-mono" id="originSingleText">—</span>
                            </div>
                          </div>
                        <div class="pw-actions">
                          <button class="pw-btn" id="btnRefreshOrigins" type="button">Refresh</button>
                          <a class="pw-btn" id="linkVerifyOrigins" href="/buyer/onboarding.html" rel="noreferrer">Verify origin</a>
                        </div>

                        <details class="pw-details" id="originVerifyDetails">
                          <summary>Add and verify a new origin</summary>
                          <div class="pw-details-body">
                            <div class="pw-muted">
                              Use this if you are publishing work for your own domain. For system apps, supported origins may already be available.
                            </div>

                            <div class="pw-row pw-mt-10">
                              <div class="pw-field">
                                <label for="originVerifyUrl">Origin URL</label>
                                <input class="pw-input" id="originVerifyUrl" placeholder="https://app.yourdomain.com" />
                              </div>
                              <div class="pw-field">
                                <label for="originVerifyMethod">Method</label>
                                <select class="pw-select" id="originVerifyMethod">
                                  <option value="dns_txt" selected>DNS TXT (recommended)</option>
                                  <option value="http_file">HTTP file</option>
                                  <option value="header">Header</option>
                                </select>
                              </div>
                            </div>

                            <div class="pw-actions">
                              <button class="pw-btn primary" id="btnOriginVerifyAdd" type="button">Get token</button>
                              <button class="pw-btn" id="btnOriginVerifyCheck" type="button" disabled>Check</button>
                              <button class="pw-btn" id="btnOriginVerifyCopyToken" type="button" disabled>Copy token</button>
                            </div>

                            <div id="originVerifyStatus" class="pw-status" role="status"></div>

                            <div class="pw-row" id="originVerifyTokenRow" hidden>
                              <div class="pw-field">
                                <div class="pw-badge">
                                  Token: <span class="pw-mono" id="originVerifyToken">—</span>
                                </div>
                              </div>
                            </div>

                            <div id="originVerifyInstructionsWrap" hidden>
                              <div class="pw-kicker pw-mt-10">Instructions</div>
                              <pre class="pw-codeblock" id="originVerifyInstructions">—</pre>
                              <div class="pw-help">After you add the proof, click Check. When verified, it will appear in the origin picker.</div>
                            </div>
                          </div>
                        </details>
                      </div>

                        <div class="pw-card soft">
                          <div class="pw-kicker">Payout</div>
                          <div class="pw-muted">
                            Pick a preset. Net to worker is after your platform cut and Proofwork’s fixed 1% fee (from the worker portion).
                          </div>
                          <div class="pw-presets" id="payoutPresets" aria-label="Payout presets"></div>
                          <div class="pw-help" id="payoutBreakdown"></div>

                          <details class="pw-details" id="customPayout">
                            <summary>Custom payout and proofs</summary>
                            <div class="pw-details-body">
                              <div class="pw-row">
                                <div class="pw-field">
                                  <label for="payoutCents">Payout (cents)</label>
                                  <input class="pw-input" id="payoutCents" type="number" value="1000" />
                                </div>
                                <div class="pw-field">
                                  <label for="requiredProofs">Proofs</label>
                                  <input class="pw-input" id="requiredProofs" type="number" value="2" />
                                </div>
                              </div>
                              <div class="pw-help">Tip: keep proofs minimal. They exist to make verification deterministic.</div>
                            </div>
                          </details>
                        </div>

                        <div class="pw-row">
                          <div class="pw-field">
                            <label for="title">Title (optional)</label>
                            <input class="pw-input" id="title" placeholder="Auto-filled" />
                            <div class="pw-help">Titles help you find bounties later. Everything else is generated from the form.</div>
                          </div>
                        </div>
                      </div>
                    </details>

                    <div class="pw-card soft" id="deliverablesCard">
                      <div class="pw-kicker">Deliverables</div>
                      <div class="pw-muted" id="deliverablesSub">What workers must submit for this app.</div>
                      <div class="pw-chips" id="deliverablesList"></div>
                      <div class="pw-help" id="deliverablesHelp"></div>
                    </div>
                  </div>

                  <div id="preflightStatus" class="pw-status" role="status"></div>
                  <div class="pw-actions" id="preflightActions" aria-label="Next action"></div>
                  <div id="createStatus" class="pw-status" role="status"></div>

                  <details class="pw-details pw-dev" id="advanced">
                    <summary>Advanced: descriptor preview</summary>
                    <div class="pw-details-body">
                      <div class="pw-row">
                        <div class="pw-field">
                          <label>Descriptor JSON</label>
                          <pre class="pw-codeblock" id="descriptorOut">{}</pre>
                        </div>
                        <div class="pw-field">
                          <label>API payload (POST /api/bounties)</label>
                          <pre class="pw-codeblock" id="payloadOut">{}</pre>
                        </div>
                      </div>
                    </div>
                  </details>
                </div>
              </details>
          </section>

          <section class="pw-card pw-view" id="monitor" data-view hidden>
            <div class="pw-card-title">
              <h2>Monitor</h2>
              <span class="pw-kicker">Your bounties + jobs for this app</span>
            </div>

            <div id="monitorGate" class="pw-badge">Connect to see bounties and jobs.</div>

            <div class="pw-actions" id="monitorActions" hidden>
              <button class="pw-btn" id="btnRefreshBounties" type="button">Refresh</button>
              <button class="pw-btn" id="btnAutoRefresh" type="button" aria-pressed="true">Auto-refresh</button>
            </div>

            <div id="monitorStatus" class="pw-status" role="status"></div>

            <div class="pw-row">
              <div class="pw-field">
                <label>Bounties</label>
                <div class="pw-scroll">
                  <table class="pw-table">
                    <thead>
                      <tr>
                        <th>Title</th>
                        <th>Status</th>
                        <th>Payout</th>
                        <th>Created</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody id="bountiesTbody"></tbody>
                  </table>
                </div>
              </div>
            </div>

            <div class="pw-row">
              <div class="pw-field">
                <label>Jobs (selected bounty)</label>
                <div class="pw-scroll">
                  <table class="pw-table">
                    <thead>
                      <tr>
                        <th>Job</th>
                        <th>Status</th>
                        <th>Verdict</th>
                        <th>Quality</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody id="jobsTbody"></tbody>
                  </table>
                </div>
              </div>
            </div>
          </section>
        </section>
      </div>
    </main>

    <div class="pw-actionbar" id="publishActionbar" aria-label="Publish bar">
      <div class="pw-actionbar-inner">
        <div class="pw-actionbar-card">
          <div class="pw-actionbar-meta">
            <div class="pw-actionbar-title" id="actionbarTitle">Publish work</div>
            <div class="pw-actionbar-sub" id="actionbarSub">Connect, fill the form, then publish in one click.</div>
          </div>
          <div class="pw-actions">
            <button class="pw-btn primary" id="btnActionbarConnect" type="button">Connect</button>
            <button class="pw-btn pw-dev" id="btnCreateDraft" type="button">Save draft</button>
            <button class="pw-btn primary" id="btnCreatePublish" type="button">Publish work</button>
          </div>
        </div>
      </div>
    </div>

    <script id="appConfig" type="application/json">{}</script>
    <script type="module" src="/apps/app_page_bootstrap.js"></script>
    <script type="module" src="/ui/shell.js"></script>
  </body>
</html>
